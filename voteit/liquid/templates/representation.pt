<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="load: ${api.template_dir}main.pt"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="voteit.liquid">
<body>
  <div metal:fill-slot="full_window" id="content"
    tal:define="represented_by repr.represented_by(api.userid)">

    <tal:messages replace="structure api.render_single_view_component(context, request, 'main', 'flash_messages')">Messages</tal:messages>
    <div class="clear"><!-- --></div>



    <h2 id="page_heading" i18n:translate="">Representation overview</h2>

    <a class="icon iconpadding arrow-left" href="${request.resource_url(context)}" i18n:translate="">Back</a>

    <div>
      <tal:enabled condition="ld_type">
        <p i18n:translate="">Liquid democracy is enabled.</p>
        <h3>
          <span i18n:translate="">Type:</span>
          <span tal:replace="structure ld_type.title">Type</span>
        </h3>
        <div tal:content="structure ld_type.description|''">Desc</div>
      </tal:enabled>
      <tal:disabled condition="not ld_type">
        <p i18n:translate="">Liquid democracy isn't enabled.</p>
      </tal:disabled>
    </div>

    <h3 i18n:translate="">Representative</h3>
    <div tal:condition="api.userid in repr"
        i18n:translate="">You're currently a representative, with ${len(repr[api.userid])} extra votes.</div>
    <div tal:condition="api.userid not in repr"
        i18n:translate="">You're not a preresentative. You can't receive votes from other users.</div>
    <a href="${request.resource_url(context, 'representative_form')}"
      class="buttonize small"
      i18n:translate="">Change</a>
    
    <h3 i18n:translate="">Representation</h3>
    <div tal:condition="represented_by == None">
      You're not represented by anyone.
    </div>
    <div tal:condition="represented_by != None">
      You're represented by:
      <div class="creators" tal:content="structure api.get_creators_info([represented_by], portrait = False)"></div>
      <a href="${request.resource_url(context, 'select_representative_form', query = {'repr': represented_by})}"
        class="buttonize small"
        i18n:translate="">Change</a>
    </div>

    <h3 i18n:translate="">Available representatives</h3>

    <table class="listing">
      <thead>
        <tr>
          <th></th>
          <th i18n:translate="">Name</th>
          <th i18n:translate="">Votes</th>
        </tr>
      </thead>
      <tbody>
        <tal:iterate repeat="userid repr.keys()">
        <tr>
          <td>
            <a class="buttonize small" href="${request.resource_url(context, 'select_representative_form', query = {'repr': userid})}">
              <span tal:condition="represented_by == userid">Current</span>
              <span tal:condition="represented_by != userid">Select</span>
            </a>
          </td>
          <td>
            <span tal:replace="structure api.get_creators_info([userid], portrait = False)"></span>
          </td>
          <td>
            ${len(repr[userid]) + 1}
          </td>
        </tr>
        </tal:iterate>
      </tbody>
    </table>

  </div> <!-- content - place nothing outside this ;) -->
</body>
</html>
